---
title: "ファイルに書き込む"
linkTitle: "ファイルに書き込む"
tags:
  - Golang
---

{{% pageinfo %}}
ドキュメントは作成中です。
{{% /pageinfo %}}

まずファイルを開きます。このときファイルが存在しない場合は作成されます。
しかし親ディレクトリが存在しない場合はエラーとなるので `os.MkdirAll` で親ディレクトリを作成し、あらためてファイルを開きます。
親ディレクトリが存在しない場合は自動で作成することが多いですが、ユーザーが任意のパスを指定できるようなアプリケーションの場合、インシデントになりかねないので、自動で作成してもよいか慎重に検討してください。
書き込む内容は `io.Reader` で受け取ります。`io.Reader` であれば、`string` を書き込みたいときは `string.NewReader("")`、`[]byte` を書き込みたいときは `bytes.NewReader([]byte{})` と柔軟に対応できます。`json.Encoder` などでエンコードしながら書き込みたい場合は、`io.Reader` でなく、`func(io.Writer) error` を受け取るとより柔軟に対応できます。
書き込み処理を行う場合、`io.Closer` の `Close` メソッドのエラーチェックを必ず行ってください。`Close` がエラーを返すことではじめて「書き込めていなかった」ことがわかる場合があるためです。

```go
func WriteFile(path string, r io.Reader) error {
	f, err := os.OpenFile(path, os.O_CREATE|os.O_TRUNC|os.O_WRONLY, 0644)
	if err != nil {
		if !errors.Is(err, os.ErrNotExist) {
			return err
		}

		if err := os.MkdirAll(filepath.Dir(path), 0755); tError != nil {
			return err
		}

		f, err = os.OpenFile(path, os.O_CREATE|os.O_TRUNC|os.O_WRONLY, 0644)
		if err != nil {
			return err
		}
	}

	_, err = io.Copy(f, r)
	if err1 := f.Close(); err == nil {
		err = err1
	}
	return err
}
```
